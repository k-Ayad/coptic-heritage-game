<div class="match-saint-game" *ngIf="canPlay()">
  <!-- Exit Button -->
  <button class="exit-button" (click)="exitGame()">
    <span class="exit-icon">‚úï</span>
    <span class="exit-text">Exit</span>
  </button>

  <!-- Header -->
  <div class="game-header">
    <h1 class="game-title">
      <span class="cross-icon">‚úù</span>
      Match the Saint
    </h1>
    <div class="progress-bar-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
      </div>
      <span class="progress-text">Question {{ currentQuestionIndex() + 1 }} of {{ shuffledQuestions().length }}</span>
    </div>
    <div class="score-display">
      <span class="score-item correct">
        <span class="score-icon">‚úì</span>
        <span class="score-value">{{ correctAnswers() }}</span>
      </span>
      <span class="score-item wrong">
        <span class="score-icon">‚úó</span>
        <span class="score-value">{{ wrongAnswers() }}</span>
      </span>
    </div>
  </div>

  <!-- Question Area -->
  <div class="question-area" *ngIf="shuffledQuestions().length > 0">
    
    <!-- Emoji Display -->
    <div class="emoji-container" [class.emoji-correct]="isCorrect() && showDescription()">
      <div class="emoji-display">{{ getCurrentQuestion().emoji }}</div>
      <p class="emoji-hint">Who is this saint?</p>
    </div>

    <!-- Answer Choices -->
    <div class="choices-container" *ngIf="!showDescription()">
      <button 
        *ngFor="let choice of getCurrentQuestion().shuffledChoices"
        class="choice-button"
        [class.choice-selected]="selectedAnswer() === choice"
        [class.choice-correct]="selectedAnswer() === choice && isCorrect()"
        [class.choice-incorrect]="selectedAnswer() === choice && !isCorrect()"
        [disabled]="selectedAnswer() !== null"
        (click)="onAnswerSelect(choice)">
        {{ choice }}
      </button>
    </div>

    <!-- Saint Description (shown for both correct and incorrect) -->
    <div class="description-container" *ngIf="showDescription()">
      <div class="success-badge" *ngIf="isCorrect()">
        <span class="success-icon">‚úì</span>
        <h3>Correct!</h3>
      </div>

      <div class="failure-badge" *ngIf="!isCorrect()">
        <span class="failure-icon">‚úó</span>
        <h3>Wrong Answer</h3>
        <p class="correct-answer-text">Correct answer: <strong>{{ getCurrentQuestion().correct }}</strong></p>
      </div>
      
      <div class="saint-info">
        <h4>{{ getCurrentQuestion().correct }}</h4>
        <p class="saint-description">{{ getCurrentQuestion().description }}</p>
      </div>

      <button class="continue-button" (click)="onContinue()">
        {{ currentQuestionIndex() + 1 < shuffledQuestions().length ? 'Continue' : 'Finish Game' }}
      </button>
    </div>
  </div>

  <!-- Fail Popup -->
  <div *ngIf="showFailPopup()" class="popup-overlay">
    <div class="popup-content">
      <h2>üò¢ Hard Luck!</h2>
      <div class="popup-body">
        <p>You answered <strong>{{ correctAnswers() }}</strong> out of <strong>{{ shuffledQuestions().length }}</strong> questions correctly.</p>
        <p>You need at least <strong>6 correct answers</strong> to pass.</p>
        <p>Would you like to try again or return to the map?</p>
      </div>
      <div class="popup-buttons">
        <button class="popup-btn popup-btn-secondary" (click)="onFailExit()">Back to Map</button>
        <button class="popup-btn popup-btn-primary" (click)="onFailTryAgain()">Try Again</button>
      </div>
    </div>
  </div>
</div>
